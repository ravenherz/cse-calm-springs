<div id="setup">
  <div class="container-fluid">
    <div class="row content">
      <div class="col-sm-2">
      </div>
      <div class="col-sm-8">
        <table class="tg">
          <tr class="tg">
            <th class="tg-yw4l" rowspan="4"></th>
            <th class="tg-yw4t" colspan="2">General site information</th>
          </tr>
          <tr class="tg">
            <td class="tg td30">
              <label for="input-welcome-title">Site title*</label>
            </td>
            <td class="tg td65">
              <input class="transition" title="input" id="input-welcome-title" type="text" required>
            </td>
          </tr>
          <tr class="tg">
            <td class="tg td30">
              <label for="input-welcome-message">Short message</label>
            </td>
            <td class="tg td65">
              <input class="transition" title="input" id="input-welcome-message" type="text">
            </td>
          </tr>
          <tr class="tg">
            <td class="tg td30">
              <label for="input-welcome-description">Short description*</label>
            </td>
            <td class="tg td65">
              <input class="transition" title="input" id="input-welcome-description" type="text"
                     required>
            </td>
          </tr>
        </table>

        <table class="tg">
          <tr class="tg">
            <th class="tg-yw4l rotate" rowspan="6"></th>
            <th class="tg-yw4t" colspan="2">Company information</th>
          </tr>
          <tr class="tg">
            <td class="tg td30">
              <label for="input-company-title">Company title*</label>
            </td>
            <td class="tg td65">
              <input class="transition" title="input" id="input-company-title" type="text"
                     required>
            </td>
          </tr>
          <tr class="tg">
            <td class="tg td30">
              <label for="input-company-address">Physical address</label>
            </td>
            <td class="tg td65">
              <input class="transition" title="input" id="input-company-address" type="text">
            </td>
          </tr>
          <tr class="tg">
            <td class="tg td30">
              <label for="input-company-phone">Phone number</label>
            </td>
            <td class="tg td65">
              <input class="transition" title="input" id="input-company-phone" type="text">
            </td>
          </tr>
          <tr class="tg">
            <td class="tg td30">
              <label for="input-company-email">E-mail</label>
            </td>
            <td class="tg td65">
              <input class="transition" title="input" id="input-company-email" type="text">
            </td>
          </tr>
          <tr class="tg">
            <td class="tg td30">
              <label for="input-company-social">Social media</label>
            </td>
            <td class="tg td65">
              <input class="transition" title="input" id="input-company-social" type="text">
            </td>
          </tr>
        </table>

        <table class="tg">
          <tr class="tg">
            <th class="tg-yw4l rotate" rowspan="3"></th>
            <th class="tg-yw4t" colspan="2">Copyright information</th>
          </tr>
          <tr class="tg">
            <td class="tg td30">
              <label for="input-copyright-holder">Owner of rights</label>
            </td>
            <td class="tg td65">
              <input class="transition" title="input" id="input-copyright-holder" type="text">
          </tr>
          <tr class="tg">
            <td class="tg td30">
              <label for="input-copyright-comment">License</label>
            </td>
            <td class="tg td65">
              <input class="transition" title="input" id="input-copyright-comment" type="text">
            </td>
          </tr>
        </table>

        <table class="tg">
          <tr class="tg">
            <th class="tg-yw4l rotate" rowspan="3"></th>
            <th class="tg-yw4t" colspan="2">Studio information</th>
          </tr>
          <tr class="tg">
            <td class="tg td30">
              <label for="input-builder-title">Studio title</label>
            </td>
            <td class="tg td65">
              <input class="transition" title="input" id="input-builder-title" type="text">
            </td>
          </tr>
          <tr class="tg">
            <td class="tg td30">
              <label for="input-builder-refer">URL</label>
            </td>
            <td class="tg td65">
              <input class="transition" title="input" id="input-builder-refer" type="text">
            </td>
          </tr>
        </table>

        <button id="setup-button" class="transition" onclick="gatherData()">Finish</button>
      </div>
      <div class="col-sm-2">
      </div>
      <script type="text/javascript">
          var inputBuilderTitle = document.getElementById("input-builder-title");
          var inputBuilderRefer = document.getElementById("input-builder-refer");
          var inputCopyrightComment = document.getElementById("input-copyright-comment");
          var inputCopyrightHolder = document.getElementById("input-copyright-holder");
          var inputOrganizationAddress = document.getElementById("input-company-address");
          var inputOrganizationEmail = document.getElementById("input-company-email");
          var inputOrganizationPhone = document.getElementById("input-company-phone");
          var inputOrganizationSocial = document.getElementById("input-company-social");
          var inputOrganizationTitle = document.getElementById("input-company-title");
          var inputWelcomeTitle = document.getElementById("input-welcome-title");
          var inputWelcomeDescription = document.getElementById("input-welcome-description");
          var inputWelcomeMessage = document.getElementById("input-welcome-message");

          function setValue(input) {
              var title = input.id.replace("input-", "");
              var output = document.getElementById(title);
              var container = document.getElementById(title + "-container");
              output.innerHTML = input.value;
              if (input.value.length > 0) {
                  container.style.display = "inline-block";
              } else {
                  container.style.display = "none";
              }

              focusOn(input);
          }

          function replaceHref(input, prefix) {
              var title = input.id.replace("input-", "");
              var container = document.getElementById(title + "-container");
              var output = document.getElementById(title);
              output.href = prefix + input.value;
              if (input.value.length > 0) {
                  container.style.display = "inline-block";
              } else {
                  container.style.display = "none";
              }
              focusOn(input);
          }

          function focusOn(input) {
              const effectClass = "temporary-glow";
              let container = document.getElementById(
                  input.id.replace("input-", "") + "-container");
              document.getElementsByName("highlightable").forEach(function (t) {
                  t.classList.add("transition");
                  if (t !== container) {
                      t.classList.remove(effectClass);
                  } else {
                      t.classList.add(effectClass);
                  }
              })
          }

          function gatherData() {
              const data = {};
              document.getElementsByName("input").forEach(function (i) {
                  data[i.id.replace("input-", "")] = i.value;
              });
              $.ajax({
                  url: 'setup/setuporg',
                  type: 'POST',
                  contentType: "application/json",
                  data: JSON.stringify(data),
                  success: function (data) {
                      updatePageContents(data);
                  }
              });
          }

          inputBuilderTitle.addEventListener("keyup", function () {
              setValue(inputBuilderTitle);
          });

          inputBuilderRefer.addEventListener("keyup", function () {
              let result = inputBuilderRefer.value;
              const https = "https://";
              if (result.indexOf(https) === -1) {
                  result = https + result;
              }
              document.getElementById('builder-title').href = result;
              focusOn(inputBuilderTitle);
          });

          inputCopyrightComment.addEventListener("keyup", function () {
              setValue(inputCopyrightComment);
          });

          inputCopyrightHolder.addEventListener("keyup", function () {
              setValue(inputCopyrightHolder);
          });

          inputOrganizationAddress.addEventListener("keyup", function () {
              setValue(inputOrganizationAddress);
          });

          inputOrganizationEmail.addEventListener("keyup", function () {
              let link = inputOrganizationEmail.value;
              let mailto = "mailto:";
              if (link.indexOf(mailto) !== -1) {
                  mailto = "";
              }
              replaceHref(inputOrganizationEmail, mailto)
          });

          inputOrganizationPhone.addEventListener("keyup", function () {
              setValue(inputOrganizationPhone);
          });

          inputOrganizationSocial.addEventListener("keyup", function () {
              let data = {};
              data['request'] = inputOrganizationSocial.value;
              focusOn(inputOrganizationSocial);

              $.ajax({
                  url: 'uihelper/tagsocial',
                  type: 'POST',
                  dataType: 'json',
                  contentType: 'text/html',
                  mimeType: 'text/html',
                  data: JSON.stringify(data),
                  success: function (data) {
                      document.getElementById(
                          "company-social-container").innerHTML = data['response'];
                  }
              });

          });

          inputOrganizationTitle.addEventListener("keyup", function () {
              setValue(inputOrganizationTitle);
          });

          inputWelcomeDescription.addEventListener("keyup", function () {
              setValue(inputWelcomeDescription);
          });

          inputWelcomeMessage.addEventListener("keyup", function () {
              setValue(inputWelcomeMessage);
          });

          inputWelcomeTitle.addEventListener("keyup", function () {
              setValue(inputWelcomeTitle);
          });

          $(document).ready(function () {

              $.ajax({
                  url: 'setup/getorginfo',
                  type: 'GET',
                  dataType: 'json',
                  contentType: 'text/html',
                  mimeType: 'text/html',
                  data: '',
                  success: function (data) {
                      document.getElementsByName("input").forEach(function (i) {
                          i.value = data[i.id.replace("input-", "")];
                      })
                  }
              })
          })
      </script>
    </div>
  </div>
</div>
<div id="post-message" hidden=true>
</div>

